(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[558],{3081:(e,t,r)=>{"use strict";var n=r(2581);r.o(n,"useParams")&&r.d(t,{useParams:function(){return n.useParams}}),r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}}),r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},3540:(e,t,r)=>{"use strict";r.d(t,{C:()=>l,Q:()=>c});var n=r(4114),s=r(826),u=r(3081),i=r(9771);let a=(0,s.createContext)(void 0),o="tab_binding";function c(e){let{children:t}=e,r=(0,u.useRouter)(),[c,l]=(0,s.useState)(()=>sessionStorage.getItem(o)),d=(0,s.useRef)(Date.now()),h=(0,s.useRef)(null),m=(0,s.useRef)(null),f=(0,s.useRef)(null),v=(0,s.useCallback)(()=>{f.current||(f.current=setTimeout(()=>{f.current=null},5e3),d.current=Date.now(),h.current&&clearTimeout(h.current),h.current=setTimeout(()=>{l(null),sessionStorage.removeItem(o),r.push("/session-expired")},9e5))},[r]),w=(0,s.useCallback)(async()=>{if(c)try{let e=(0,i.e)();await fetch("".concat(e,"/auth/heartbeat"),{method:"POST",headers:{"Content-Type":"application/json","X-Tab-Binding":c},credentials:"include"})}catch(e){console.error("Heartbeat failed:",e),l(null),sessionStorage.removeItem(o),r.push("/session-expired")}},[c,r]);return(0,s.useEffect)(()=>{let e=["mousedown","mousemove","keydown","scroll","touchstart","click"];e.forEach(e=>{window.addEventListener(e,v)});let t=()=>{document.hidden||v()};return document.addEventListener("visibilitychange",t),()=>{e.forEach(e=>{window.removeEventListener(e,v)}),document.removeEventListener("visibilitychange",t)}},[v]),(0,s.useEffect)(()=>(c&&(m.current=setInterval(w,3e4)),()=>{m.current&&clearInterval(m.current)}),[c,w]),(0,s.useEffect)(()=>()=>{h.current&&clearTimeout(h.current),m.current&&clearInterval(m.current),f.current&&clearTimeout(f.current)},[]),(0,n.jsx)(a.Provider,{value:{binding:c,setBinding:e=>{l(e),sessionStorage.setItem(o,e),v()},clearBinding:()=>{l(null),sessionStorage.removeItem(o),h.current&&clearTimeout(h.current),m.current&&clearInterval(m.current)},isActive:()=>!!c&&Date.now()-d.current<9e5},children:t})}function l(){let e=(0,s.useContext)(a);if(void 0===e)throw Error("useTabBinding must be used within a TabBindingProvider");return e}},3919:()=>{},4253:(e,t,r)=>{"use strict";r.d(t,{Providers:()=>u});var n=r(4114),s=r(3540);function u(e){let{children:t}=e;return(0,n.jsx)(s.Q,{children:t})}},6113:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,3919,23)),Promise.resolve().then(r.bind(r,4253))},9771:(e,t,r)=>{"use strict";function n(){let{hostname:e}=window.location;return"localhost"===e||"127.0.0.1"===e?"http://localhost:3001/api":"/api"}async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;if(!r)throw Error("No tab binding available");let s=new Headers(t.headers);s.set("X-Tab-Binding",r);let u=n(),i=e.startsWith("http")?e:"".concat(u).concat(e),a=await fetch(i,{...t,headers:s,credentials:"include"});if(401===a.status)throw window.location.href="/session-expired",Error("Session expired");return a}r.d(t,{e:()=>n,t:()=>s})}},e=>{e.O(0,[920,919,142,358],()=>e(e.s=6113)),_N_E=e.O()}]);